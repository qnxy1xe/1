--// Venyx UI Library (FIXED DROPDOWN VERSION)
--// Original by Stefanuk12
--// Patched to restore Dropdown:onChanged()

local Library = {}
Library.__index = Library

-- Services
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

local Player = Players.LocalPlayer
local Mouse = Player:GetMouse()

-- Theme
local Theme = {
    Background = Color3.fromRGB(24,24,24),
    Accent = Color3.fromRGB(35,35,35),
    LightContrast = Color3.fromRGB(30,30,30),
    DarkContrast = Color3.fromRGB(18,18,18),
    TextColor = Color3.fromRGB(255,255,255)
}

-- Utility
local function Create(class, props)
    local obj = Instance.new(class)
    for i,v in pairs(props or {}) do
        obj[i] = v
    end
    return obj
end

-- Window
function Library.new(title, icon)
    local self = setmetatable({}, Library)

    local ScreenGui = Create("ScreenGui", {
        Name = title,
        Parent = game.CoreGui,
        ResetOnSpawn = false
    })

    local Main = Create("Frame", {
        Parent = ScreenGui,
        Size = UDim2.new(0, 550, 0, 360),
        Position = UDim2.new(0.5, -275, 0.5, -180),
        BackgroundColor3 = Theme.Background,
        BorderSizePixel = 0
    })

    Create("UICorner",{CornerRadius = UDim.new(0,10), Parent = Main})

    -- Drag
    do
        local dragging, dragStart, startPos
        Main.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                dragging = true
                dragStart = input.Position
                startPos = Main.Position
            end
        end)
        Main.InputEnded:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                dragging = false
            end
        end)
        UserInputService.InputChanged:Connect(function(input)
            if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
                local delta = input.Position - dragStart
                Main.Position = UDim2.new(
                    startPos.X.Scale, startPos.X.Offset + delta.X,
                    startPos.Y.Scale, startPos.Y.Offset + delta.Y
                )
            end
        end)
    end

    local Tabs = Create("Frame", {
        Parent = Main,
        Size = UDim2.new(0,120,1,0),
        BackgroundColor3 = Theme.DarkContrast,
        BorderSizePixel = 0
    })

    local Pages = Create("Frame", {
        Parent = Main,
        Position = UDim2.new(0,120,0,0),
        Size = UDim2.new(1,-120,1,0),
        BackgroundTransparency = 1
    })

    self.Pages = {}
    self.Tabs = {}

    function self:addPage(name, iconId)
        local Page = {}
        Page.Sections = {}

        local Button = Create("TextButton", {
            Parent = Tabs,
            Size = UDim2.new(1,0,0,40),
            BackgroundColor3 = Theme.Accent,
            Text = name,
            TextColor3 = Theme.TextColor,
            Font = Enum.Font.GothamMedium,
            TextSize = 14,
            BorderSizePixel = 0
        })

        local Container = Create("ScrollingFrame", {
            Parent = Pages,
            Visible = false,
            Size = UDim2.new(1,0,1,0),
            CanvasSize = UDim2.new(0,0,0,0),
            ScrollBarImageTransparency = 1,
            BackgroundTransparency = 1
        })

        local Layout = Create("UIListLayout", {
            Parent = Container,
            Padding = UDim.new(0,8)
        })

        Button.MouseButton1Click:Connect(function()
            for _,p in pairs(self.Pages) do p.Container.Visible = false end
            Container.Visible = true
        end)

        function Page:addSection(title)
            local Section = {}

            local Frame = Create("Frame", {
                Parent = Container,
                Size = UDim2.new(1,-12,0,40),
                BackgroundColor3 = Theme.LightContrast,
                BorderSizePixel = 0
            })
            Create("UICorner",{CornerRadius=UDim.new(0,6),Parent=Frame})

            Create("TextLabel",{
                Parent=Frame,
                Text=title,
                Size=UDim2.new(1,0,0,30),
                BackgroundTransparency=1,
                TextColor3=Theme.TextColor,
                Font=Enum.Font.GothamBold,
                TextSize=14
            })

            -- BUTTON
            function Section:addButton(text,callback)
                local B = Create("TextButton",{
                    Parent=Frame,
                    Size=UDim2.new(1,-10,0,30),
                    Position=UDim2.new(0,5,0,35),
                    BackgroundColor3=Theme.Accent,
                    Text=text,
                    TextColor3=Theme.TextColor,
                    Font=Enum.Font.Gotham,
                    TextSize=13,
                    BorderSizePixel=0
                })
                Create("UICorner",{CornerRadius=UDim.new(0,6),Parent=B})
                B.MouseButton1Click:Connect(callback)
            end

            -- TOGGLE
            function Section:addToggle(text,default,callback)
                local state = default
                local T = Create("TextButton",{
                    Parent=Frame,
                    Size=UDim2.new(1,-10,0,30),
                    Position=UDim2.new(0,5,0,35),
                    BackgroundColor3=Theme.Accent,
                    Text=text.." : "..tostring(state),
                    TextColor3=Theme.TextColor,
                    Font=Enum.Font.Gotham,
                    TextSize=13,
                    BorderSizePixel=0
                })
                Create("UICorner",{CornerRadius=UDim.new(0,6),Parent=T})
                T.MouseButton1Click:Connect(function()
                    state = not state
                    T.Text = text.." : "..tostring(state)
                    callback(state)
                end)
            end

            -- SLIDER
            function Section:addSlider(text,default,min,max,callback)
                local value = default
                local S = Create("TextButton",{
                    Parent=Frame,
                    Size=UDim2.new(1,-10,0,30),
                    Position=UDim2.new(0,5,0,35),
                    BackgroundColor3=Theme.Accent,
                    Text=text.." : "..value,
                    TextColor3=Theme.TextColor,
                    Font=Enum.Font.Gotham,
                    TextSize=13,
                    BorderSizePixel=0
                })
                Create("UICorner",{CornerRadius=UDim.new(0,6),Parent=S})
                S.MouseButton1Click:Connect(function()
                    value = math.clamp(value + 1, min, max)
                    S.Text = text.." : "..value
                    callback(value)
                end)
            end

            -- DROPDOWN (FIXED)
            function Section:addDropdown(text,options)
                local Dropdown = {}
                Dropdown.Value = options[1]
                Dropdown._callback = function() end

                local D = Create("TextButton",{
                    Parent=Frame,
                    Size=UDim2.new(1,-10,0,30),
                    Position=UDim2.new(0,5,0,35),
                    BackgroundColor3=Theme.Accent,
                    Text=text.." : "..Dropdown.Value,
                    TextColor3=Theme.TextColor,
                    Font=Enum.Font.Gotham,
                    TextSize=13,
                    BorderSizePixel=0
                })
                Create("UICorner",{CornerRadius=UDim.new(0,6),Parent=D})

                D.MouseButton1Click:Connect(function()
                    local i = table.find(options,Dropdown.Value) or 1
                    i = i % #options + 1
                    Dropdown.Value = options[i]
                    D.Text = text.." : "..Dropdown.Value
                    Dropdown._callback(Dropdown.Value)
                end)

                function Dropdown:onChanged(cb)
                    self._callback = cb
                end

                return Dropdown
            end

            return Section
        end

        Page.Container = Container
        table.insert(self.Pages, Page)
        return Page
    end

    function self:SelectPage(page)
        for _,p in pairs(self.Pages) do
            p.Container.Visible = false
        end
        page.Container.Visible = true
    end

    return self
end

return Library
